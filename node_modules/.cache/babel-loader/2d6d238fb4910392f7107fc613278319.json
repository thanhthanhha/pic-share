{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\pic\\\\pic-share\\\\src\\\\helpers\\\\useAuth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState();\n  const [error, setError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [isLogin, setisLogin] = useState(false);\n  const [loadInit, setloadInit] = useState(false);\n  const location = useLocation();\n  const history = useNavigate();\n  useEffect(() => {\n    if (error) setError(null);\n  }, [location.pathname]);\n  useEffect(() => {\n    if (user) localStorage.setItem('user', user.username);\n  }, [user]);\n  useEffect(() => {\n    let token = localStorage.getItem('token');\n\n    async function verifyLogin() {\n      setLoading(true);\n      let res = await axios.get(`${process.env.REACT_APP_BACKEND_URI}/welcome`, {\n        headers: {\n          'x-access-token': token,\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(res => {\n        if (res.data.username && res.data.token) {\n          setUser({ ...res.data\n          });\n        }\n\n        console.log(res.data.username);\n        localStorage.setItem('user', res.data.username);\n        setisLogin(true);\n      }).catch(error => {\n        setError(error);\n        localStorage.removeItem('token');\n        setUser(null);\n        setisLogin(false);\n      }).finally(() => {\n        setLoading(false);\n        console.log(\"this been made\");\n      });\n    }\n\n    console.log(\"loading\");\n\n    if (token) {\n      verifyLogin();\n    } else {\n      setloadInit(true);\n    }\n  }, [location.pathname]);\n\n  function logout() {\n    localStorage.removeItem('token');\n    setisLogin(false);\n    setUser(null);\n    history(\"/signin\");\n  }\n\n  const signUp = async (email, username, password) => {\n    setLoading(true);\n    let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/register`, {\n      \"username\": username,\n      \"email\": email,\n      \"password\": password\n    }, {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      if (res.data.username && res.data.token) {\n        setUser({ ...res.data\n        });\n        localStorage.setItem('token', res.data.token);\n        localStorage.setItem('user', res.username);\n        setisLogin(true);\n        history(\"/browse\");\n      } else {\n        throw Promise.reject('token or username not valid check network tab for request payload');\n      }\n    }).catch(error => {\n      let txterr = !error.message ? JSON.stringify(error) : error.message;\n      setError(txterr);\n      setUser(null);\n      setisLogin(false);\n    }).finally(() => {\n      setloadInit(true);\n      setLoading(false);\n    });\n  };\n\n  const login = async (username, password) => {\n    setLoading(true);\n    let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/login`, {\n      \"username\": username,\n      \"password\": password\n    }, {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      if (res.data.username && res.data.token) {\n        setUser({ ...res.data\n        });\n        localStorage.setItem('token', res.data.token);\n        localStorage.setItem('user', res.username);\n        setisLogin(true);\n        history(\"/browse\");\n      } else {\n        throw Promise.reject('token or username not valid check network tab for request payload');\n      }\n    }).catch(error => {\n      let txterr = !error.message ? JSON.stringify(error) : error.message;\n      setError(txterr);\n      setUser(null);\n      setisLogin(false);\n    }).finally(() => {\n      setloadInit(true);\n      setLoading(false);\n    });\n  };\n\n  const memoedVal = useMemo(() => ({\n    user,\n    error,\n    loading,\n    isLogin,\n    loadInit,\n    setLoading,\n    login,\n    signUp,\n    logout\n  }), [user, loading, error, isLogin, loadInit]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: memoedVal,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 160,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AuthProvider, \"DLhITJ9T0IV+WLmZiuYSV9GJV3o=\", false, function () {\n  return [useLocation, useNavigate];\n});\n\n_c = AuthProvider;\nexport default function useAuth() {\n  _s2();\n\n  return useContext(AuthContext);\n}\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","useLocation","useNavigate","axios","AuthContext","AuthProvider","children","user","setUser","error","setError","loading","setLoading","isLogin","setisLogin","loadInit","setloadInit","location","history","pathname","localStorage","setItem","username","token","getItem","verifyLogin","res","get","process","env","REACT_APP_BACKEND_URI","headers","then","data","console","log","catch","removeItem","finally","logout","signUp","email","password","post","Promise","reject","txterr","message","JSON","stringify","login","memoedVal","useAuth"],"sources":["D:/Git/pic/pic-share/src/helpers/useAuth.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from 'react';\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport axios from 'axios';\r\n\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [user, setUser] = useState();\r\n    const [error, setError] = useState();\r\n    const [loading, setLoading] = useState(false);\r\n    const [isLogin, setisLogin] = useState(false);\r\n    const [loadInit, setloadInit] = useState(false);\r\n\r\n    const location = useLocation();\r\n    const history = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (error) setError(null);\r\n \r\n      }, [location.pathname]);\r\n\r\n    useEffect(() => {\r\n        if (user) localStorage.setItem('user',user.username);\r\n    },[user])\r\n\r\n    useEffect(() => {\r\n        let token = localStorage.getItem('token');\r\n        async function verifyLogin() {\r\n            setLoading(true);\r\n            let res = await axios.get(`${process.env.REACT_APP_BACKEND_URI}/welcome`,{\r\n                headers: {\r\n                    'x-access-token' : token,\r\n                    'Accept' : 'application/json',\r\n                    'Content-Type' : 'application/json',\r\n                }\r\n            })\r\n            .then(res => {\r\n                if (res.data.username && res.data.token) {\r\n                    setUser({...res.data}); \r\n                }\r\n                console.log(res.data.username);\r\n                localStorage.setItem('user',res.data.username);\r\n                setisLogin(true);\r\n            })\r\n            .catch((error) => {\r\n                setError(error);\r\n                localStorage.removeItem('token');\r\n                setUser(null);\r\n                setisLogin(false);\r\n            })\r\n            .finally(() => {\r\n                setLoading(false);\r\n                console.log(\"this been made\");\r\n            });\r\n        }\r\n        console.log(\"loading\");\r\n        if (token) {\r\n        verifyLogin();\r\n        } else {\r\n        setloadInit(true);\r\n        }\r\n    },[location.pathname]);\r\n\r\n    function logout() {\r\n        localStorage.removeItem('token');\r\n        setisLogin(false);\r\n        setUser(null);\r\n        history(\"/signin\");\r\n    }\r\n\r\n    const signUp = async (email, username, password) => {\r\n        setLoading(true);\r\n\r\n        let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/register`, {\r\n                \"username\": username,\r\n                \"email\" : email,\r\n                \"password\": password\r\n        },{\r\n            headers: {\r\n                'Accept' : 'application/json',\r\n                'Content-Type' : 'application/json',\r\n            }\r\n        })\r\n        .then((res) => {\r\n\r\n            if (res.data.username && res.data.token) {\r\n                setUser({...res.data});\r\n                localStorage.setItem('token', res.data.token);\r\n                localStorage.setItem('user',res.username);\r\n                setisLogin(true);\r\n                history(\"/browse\");\r\n            } else {\r\n                throw Promise.reject('token or username not valid check network tab for request payload');\r\n            }\r\n                \r\n        })\r\n        .catch((error) => {\r\n            let txterr = !error.message ? JSON.stringify(error) : error.message;\r\n            setError(txterr);\r\n            setUser(null);\r\n            setisLogin(false);\r\n        })\r\n        .finally(() => {\r\n            setloadInit(true);\r\n            setLoading(false);\r\n        });\r\n    }\r\n\r\n    const login = async (username, password) => {\r\n        setLoading(true);\r\n\r\n        let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/login`, {\r\n                \"username\": username,\r\n                \"password\": password\r\n        },{\r\n            headers: {\r\n                'Accept' : 'application/json',\r\n                'Content-Type' : 'application/json',\r\n            }\r\n        })\r\n        .then((res) => {\r\n            if (res.data.username && res.data.token) {\r\n                setUser({...res.data});\r\n                localStorage.setItem('token', res.data.token);\r\n                localStorage.setItem('user',res.username);\r\n                setisLogin(true);\r\n                history(\"/browse\");\r\n            } else {\r\n                throw Promise.reject('token or username not valid check network tab for request payload');\r\n            }\r\n        })\r\n        .catch((error) => {\r\n            let txterr = !error.message ? JSON.stringify(error) : error.message;\r\n            setError(txterr);\r\n            setUser(null);\r\n            setisLogin(false);\r\n        })\r\n        .finally(() => {\r\n            setloadInit(true);\r\n            setLoading(false);\r\n        });\r\n    }\r\n\r\n\r\n    const memoedVal = useMemo(() => ({\r\n        user,\r\n        error,\r\n        loading,\r\n        isLogin,\r\n        loadInit,\r\n        setLoading,\r\n        login,\r\n        signUp,\r\n        logout\r\n    }),\r\n    [user, loading, error, isLogin, loadInit])\r\n\r\n    return (\r\n        <AuthContext.Provider value = {memoedVal}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}