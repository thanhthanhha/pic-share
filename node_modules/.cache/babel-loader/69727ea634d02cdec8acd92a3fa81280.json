{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\pic\\\\pic-share\\\\src\\\\helpers\\\\useAuth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState();\n  const [error, setError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [isLogin, setisLogin] = useState(false);\n  const location = useLocation();\n  const history = useNavigate();\n  useEffect(() => {\n    if (error) setError(null);\n  }, [location.pathname]);\n  useEffect(() => {\n    if (user) localStorage.setItem('user', user.username);\n  }, [user]);\n  useEffect(() => {\n    let token = localStorage.getItem('token');\n\n    async function verifyLogin() {\n      let res = await axios.get(`${process.env.REACT_APP_BACKEND_URI}/welcome`, {\n        headers: {\n          'x-access-token': token,\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(res => {\n        if (res.data.username && res.data.token) {\n          setUser({ ...res.data\n          });\n        }\n\n        console.log(res.data.username);\n        localStorage.setItem('user', res.data.username);\n        setisLogin(true);\n      }).catch(error => {\n        setError(error);\n        localStorage.removeItem('token');\n        setUser(null);\n        setisLogin(false);\n      });\n    }\n\n    if (token) {\n      verifyLogin();\n    }\n  }, []);\n\n  function logout() {\n    localStorage.removeItem('token');\n    setisLogin(false);\n    setUser(null);\n  }\n\n  const signUp = async (email, username, password) => {\n    setLoading(true);\n    let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/register`, {\n      \"username\": username,\n      \"email\": email,\n      \"password\": password\n    }, {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      if (res.data.username && res.data.token) {\n        setUser({ ...res.data\n        });\n        localStorage.setItem('token', res.data.token);\n        localStorage.setItem('user', res.username);\n        setisLogin(true);\n        history(\"/browse\");\n      } else {\n        throw Promise.reject('token or username not valid check network tab for request payload');\n      }\n    }).catch(error => {\n      let txterr = !error.message ? JSON.stringify(error) : error.message;\n      setError(txterr);\n      setUser(null);\n      setisLogin(false);\n    }).finally(() => setLoading(false));\n  };\n\n  const login = async (username, password) => {\n    setLoading(true);\n    let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/login`, {\n      \"username\": username,\n      \"password\": password\n    }, {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(res => {\n      if (res.data.username && res.data.token) {\n        setUser({ ...res.data\n        });\n        localStorage.setItem('token', res.data.token);\n        localStorage.setItem('user', res.username);\n        console.log(\"redirect\");\n        setisLogin(true);\n        history(\"/browse\");\n      } else {\n        throw Promise.reject('token or username not valid check network tab for request payload');\n      }\n    }).catch(error => {\n      let txterr = !error.message ? JSON.stringify(error) : error.message;\n      setError(txterr);\n      setUser(null);\n      setisLogin(false);\n    }).finally(() => setLoading(false));\n  };\n\n  const memoedVal = useMemo(() => ({\n    user,\n    error,\n    loading,\n    isLogin,\n    login,\n    signUp,\n    logout\n  }), [user, loading, error, isLogin]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: memoedVal,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AuthProvider, \"1sEFrTkgc/VWJpI1XXT1vaoG/EQ=\", false, function () {\n  return [useLocation, useNavigate];\n});\n\n_c = AuthProvider;\nexport default function useAuth() {\n  _s2();\n\n  return useContext(AuthContext);\n}\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","useLocation","useNavigate","axios","AuthContext","AuthProvider","children","user","setUser","error","setError","loading","setLoading","isLogin","setisLogin","location","history","pathname","localStorage","setItem","username","token","getItem","verifyLogin","res","get","process","env","REACT_APP_BACKEND_URI","headers","then","data","console","log","catch","removeItem","logout","signUp","email","password","post","Promise","reject","txterr","message","JSON","stringify","finally","login","memoedVal","useAuth"],"sources":["D:/Git/pic/pic-share/src/helpers/useAuth.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from 'react';\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport axios from 'axios';\r\n\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [user, setUser] = useState();\r\n    const [error, setError] = useState();\r\n    const [loading, setLoading] = useState(false);\r\n    const [isLogin, setisLogin] = useState(false);\r\n\r\n    const location = useLocation();\r\n    const history = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (error) setError(null);\r\n \r\n      }, [location.pathname]);\r\n\r\n    useEffect(() => {\r\n        if (user) localStorage.setItem('user',user.username);\r\n        \r\n    },[user])\r\n\r\n    useEffect(() => {\r\n        let token = localStorage.getItem('token');\r\n        async function verifyLogin() {\r\n            let res = await axios.get(`${process.env.REACT_APP_BACKEND_URI}/welcome`,{\r\n                headers: {\r\n                    'x-access-token' : token,\r\n                    'Accept' : 'application/json',\r\n                    'Content-Type' : 'application/json',\r\n                }\r\n            })\r\n            .then(res => {\r\n                if (res.data.username && res.data.token) {\r\n                    setUser({...res.data}); \r\n                }\r\n                console.log(res.data.username);\r\n                localStorage.setItem('user',res.data.username);\r\n                setisLogin(true);\r\n            })\r\n            .catch((error) => {\r\n                setError(error);\r\n                localStorage.removeItem('token');\r\n                setUser(null);\r\n                setisLogin(false);\r\n            })\r\n        }\r\n        if (token) {\r\n        verifyLogin();\r\n    \r\n        }\r\n    },[]);\r\n\r\n    function logout() {\r\n        localStorage.removeItem('token');\r\n        setisLogin(false);\r\n        setUser(null);\r\n    }\r\n\r\n    const signUp = async (email, username, password) => {\r\n        setLoading(true);\r\n\r\n        let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/register`, {\r\n                \"username\": username,\r\n                \"email\" : email,\r\n                \"password\": password\r\n        },{\r\n            headers: {\r\n                'Accept' : 'application/json',\r\n                'Content-Type' : 'application/json',\r\n            }\r\n        })\r\n        .then((res) => {\r\n\r\n            if (res.data.username && res.data.token) {\r\n                setUser({...res.data});\r\n                localStorage.setItem('token', res.data.token);\r\n                localStorage.setItem('user',res.username);\r\n                setisLogin(true);\r\n                history(\"/browse\");\r\n            } else {\r\n                throw Promise.reject('token or username not valid check network tab for request payload');\r\n            }\r\n                \r\n        })\r\n        .catch((error) => {\r\n            let txterr = !error.message ? JSON.stringify(error) : error.message;\r\n            setError(txterr);\r\n            setUser(null);\r\n            setisLogin(false);\r\n        })\r\n        .finally(() => setLoading(false));\r\n    }\r\n\r\n    const login = async (username, password) => {\r\n        setLoading(true);\r\n\r\n        let res = await axios.post(`${process.env.REACT_APP_BACKEND_URI}/login`, {\r\n                \"username\": username,\r\n                \"password\": password\r\n        },{\r\n            headers: {\r\n                'Accept' : 'application/json',\r\n                'Content-Type' : 'application/json',\r\n            }\r\n        })\r\n        .then((res) => {\r\n            if (res.data.username && res.data.token) {\r\n                setUser({...res.data});\r\n                localStorage.setItem('token', res.data.token);\r\n                localStorage.setItem('user',res.username);\r\n                console.log(\"redirect\");\r\n                setisLogin(true);\r\n                history(\"/browse\");\r\n            } else {\r\n                throw Promise.reject('token or username not valid check network tab for request payload');\r\n            }\r\n        })\r\n        .catch((error) => {\r\n            let txterr = !error.message ? JSON.stringify(error) : error.message;\r\n            setError(txterr);\r\n            setUser(null);\r\n            setisLogin(false);\r\n        })\r\n        .finally(() => setLoading(false));\r\n    }\r\n\r\n\r\n    const memoedVal = useMemo(() => ({\r\n        user,\r\n        error,\r\n        loading,\r\n        isLogin,\r\n        login,\r\n        signUp,\r\n        logout\r\n    }),\r\n    [user, loading, error, isLogin])\r\n\r\n    return (\r\n        <AuthContext.Provider value = {memoedVal}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}